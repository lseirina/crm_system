# Mini-CRM Lead Distribution System

Система распределения лидов между операторами по источникам.

## Основные особенности

### Модель нагрузки
- **Нагрузка оператора** = количество обращений со статусом "new" или "in_progress"
- **Лимит нагрузки** задается для каждого оператора (поле `max_load`)
- Оператор не получает новые обращения при достижении лимита

### Распределение обращений
- **Алгоритм**: взвешенный случайный выбор среди доступных операторов
- **Доступные операторы**: активные операторы с нагрузкой ниже лимита
- **При отсутствии операторов**: обращение создается без назначения оператора

### Идентификация лидов
- **Уникальный идентификатор**: поле `external_id` (телефон, email или другой идентификатор)
- Обращения от одного лида из разных источников связываются автоматически

## API Endpoints

### Управление операторами
- `POST /operators/` - создание оператора
- `GET /operators/` - список операторов с текущей нагрузкой

### Управление источниками
- `POST /sources/` - создание источника

### Настройка распределения
- `POST /distribution/config/` - настройка весов операторов для источника

### Регистрация обращений
- `POST /contacts/` - создание обращения с автоматическим распределением

### Просмотр состояния
- `GET /contacts/` - список всех обращений
- `GET /leads/with-contacts/` - лиды с их обращениями

## Пример использования

1. Создать операторов:
```bash
curl -X POST "http://localhost:8000/operators/" -H "Content-Type: application/json" -d '{"name": "Оператор 1", "max_load": 5}'